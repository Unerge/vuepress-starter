{"version":3,"file":"Mermaid.js","sources":["../../../src/client/components/Mermaid.ts"],"sourcesContent":["import {\n  LoadingIcon,\n  decodeData,\n  isFunction,\n  wait,\n} from \"@vuepress/helper/client\";\nimport { useMutationObserver } from \"@vueuse/core\";\nimport type { VNode } from \"vue\";\nimport {\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  shallowRef,\n  watch,\n} from \"vue\";\n\nimport { useMermaidOptions } from \"../helpers/index.js\";\nimport type { MermaidThemeVariables } from \"../typings/index.js\";\nimport { getDarkmodeStatus } from \"../utils/index.js\";\n\nimport \"../styles/mermaid.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nconst DEFAULT_CHART_OPTIONS = { useMaxWidth: false };\n\nconst getThemeVariables = (isDarkmode: boolean): MermaidThemeVariables => ({\n  dark: isDarkmode,\n  background: isDarkmode ? \"#1e1e1e\" : \"#fff\",\n\n  primaryColor: isDarkmode ? \"#389d70\" : \"#4abf8a\",\n  primaryBorderColor: isDarkmode ? \"#389d70\" : \"#4abf8a\",\n  primaryTextColor: isDarkmode ? \"#fff\" : \"#000\",\n\n  secondaryColor: \"#ffb500\",\n  secondaryBorderColor: isDarkmode ? \"#fff\" : \"#000\",\n  secondaryTextColor: isDarkmode ? \"#ddd\" : \"#333\",\n\n  tertiaryColor: isDarkmode ? \"#282828\" : \"#efeef4\",\n  tertiaryBorderColor: isDarkmode ? \"#bbb\" : \"#242424\",\n  tertiaryTextColor: isDarkmode ? \"#ddd\" : \"#333\",\n\n  // Note\n  noteBkgColor: isDarkmode ? \"#f6d365\" : \"#fff5ad\",\n  noteTextColor: \"#242424\",\n  noteBorderColor: isDarkmode ? \"#f6d365\" : \"#333\",\n\n  lineColor: isDarkmode ? \"#d3d3d3\" : \"#333\",\n  textColor: isDarkmode ? \"#fff\" : \"#242424\",\n\n  mainBkg: isDarkmode ? \"#389d70\" : \"#4abf8a\",\n  errorBkgColor: \"#eb4d5d\",\n  errorTextColor: \"#fff\",\n\n  // Flowchart\n  nodeBorder: isDarkmode ? \"#389d70\" : \"#4abf8a\",\n  nodeTextColor: isDarkmode ? \"#fff\" : \"#242424\",\n\n  // Sequence\n  signalTextColor: isDarkmode ? \"#9e9e9e\" : \"#242424\",\n\n  // Class\n  classText: \"#fff\",\n\n  // State\n  labelColor: \"#fff\",\n\n  attributeBackgroundColorEven: isDarkmode ? \"#0d1117\" : \"#fff\",\n  attributeBackgroundColorOdd: isDarkmode ? \"#161b22\" : \"#f8f8f8\",\n\n  // Colors\n  fillType0: isDarkmode ? \"#cf1322\" : \"#f1636e\",\n  fillType1: \"#f39c12\",\n  fillType2: \"#2ecc71\",\n  fillType3: \"#fa541c\",\n  fillType4: \"#25a55b\",\n  fillType5: \"#13c2c2\",\n  fillType6: \"#096dd9\",\n  fillType7: \"#aa6fe9\",\n});\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Mermaid\",\n\n  props: {\n    /**\n     * Mermaid id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Mermaid config\n     *\n     * Mermaid 配置\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Mermaid title\n     *\n     * Mermaid 标题\n     */\n    title: { type: String, default: \"\" },\n  },\n\n  setup(props) {\n    const { themeVariables, ...mermaidOptions } = useMermaidOptions();\n    const mermaidElement = shallowRef<HTMLElement>();\n\n    const code = computed(() => decodeData(props.code));\n\n    const svgCode = ref(\"\");\n    const isDarkmode = ref(false);\n    let loaded = false;\n\n    const renderMermaid = async (): Promise<void> => {\n      const [{ default: mermaid }] = await Promise.all([\n        import(\n          /* webpackChunkName: \"mermaid\" */ \"mermaid/dist/mermaid.esm.min.mjs\"\n        ),\n        loaded\n          ? Promise.resolve()\n          : ((loaded = true), wait(MARKDOWN_ENHANCE_DELAY)),\n      ]);\n\n      mermaid.initialize({\n        theme: \"base\",\n        themeVariables: {\n          ...getThemeVariables(isDarkmode.value),\n          ...(isFunction(themeVariables)\n            ? themeVariables(isDarkmode.value)\n            : themeVariables),\n        },\n        flowchart: DEFAULT_CHART_OPTIONS,\n        sequence: DEFAULT_CHART_OPTIONS,\n        journey: DEFAULT_CHART_OPTIONS,\n        gantt: DEFAULT_CHART_OPTIONS,\n        er: DEFAULT_CHART_OPTIONS,\n        pie: DEFAULT_CHART_OPTIONS,\n        ...mermaidOptions,\n        startOnLoad: false,\n      });\n\n      svgCode.value = (await mermaid.render(props.id, code.value)).svg;\n    };\n\n    const preview = (): void => {\n      const { body } = document;\n      const div = document.createElement(\"div\");\n\n      div.classList.add(\"mermaid-preview\");\n\n      div.innerHTML = svgCode.value;\n      body.appendChild(div);\n\n      div.addEventListener(\"click\", () => {\n        body.removeChild(div);\n      });\n    };\n\n    const download = (): void => {\n      const dataURI = `data:image/svg+xml;charset=utf8,${svgCode.value\n        .replace(/<br>/g, \"<br />\")\n        .replace(/%/g, \"%25\")\n        .replace(/\"/g, \"%22\")\n        .replace(/'/g, \"%27\")\n        .replace(/&/g, \"%26\")\n        .replace(/#/g, \"%23\")\n        .replace(/{/g, \"%7B\")\n        .replace(/}/g, \"%7D\")\n        .replace(/</g, \"%3C\")\n        .replace(/>/g, \"%3E\")}`;\n\n      const a = document.createElement(\"a\");\n\n      a.setAttribute(\"href\", dataURI);\n      a.setAttribute(\n        \"download\",\n        `${props.title ? decodeData(props.title) : props.id}.svg`,\n      );\n      a.click();\n    };\n\n    onMounted(() => {\n      isDarkmode.value = getDarkmodeStatus();\n\n      void renderMermaid();\n\n      // Watch darkmode change\n      useMutationObserver(\n        document.documentElement,\n        () => {\n          isDarkmode.value = getDarkmodeStatus();\n        },\n        {\n          attributeFilter: [\"class\", \"data-theme\"],\n          attributes: true,\n        },\n      );\n\n      watch(isDarkmode, () => renderMermaid());\n    });\n\n    return (): VNode[] => [\n      h(\"div\", { class: \"mermaid-actions\" }, [\n        h(\"button\", {\n          class: \"preview-button\",\n          onClick: () => preview(),\n          title: \"preview\",\n          innerHTML:\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1316 1024\" fill=\"currentColor\"><path d=\"M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z\"/><path d=\"M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z\"/></svg>',\n        }),\n        h(\"button\", {\n          class: \"download-button\",\n          onClick: () => download(),\n          title: \"download\",\n          innerHTML:\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1024 1024\" fill=\"currentColor\"><path d=\"M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z\"/></svg>',\n        }),\n      ]),\n      h(\n        \"div\",\n        {\n          ref: mermaidElement,\n          class: \"mermaid-wrapper\",\n        },\n        svgCode.value\n          ? // Mermaid\n            h(\"div\", { class: \"mermaid-content\", innerHTML: svgCode.value })\n          : // Loading\n            h(LoadingIcon, { class: \"mermaid-loading\", height: 96 }),\n      ),\n    ];\n  },\n});\n"],"names":["DEFAULT_CHART_OPTIONS","getThemeVariables","isDarkmode","defineComponent","props","themeVariables","mermaidOptions","useMermaidOptions","mermaidElement","shallowRef","code","computed","decodeData","svgCode","ref","loaded","renderMermaid","mermaid","wait","isFunction","preview","body","div","download","dataURI","a","onMounted","getDarkmodeStatus","useMutationObserver","watch","h","LoadingIcon"],"mappings":"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"}