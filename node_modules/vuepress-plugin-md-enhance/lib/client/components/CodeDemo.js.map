{"version":3,"file":"CodeDemo.js","sources":["../../../src/client/utils/code-demo/utils.ts","../../../src/client/utils/code-demo/getCode.ts","../../../src/client/composables/loadScript.ts","../../../src/client/components/CodeDemo.ts"],"sourcesContent":["import { isDef, isPlainObject, keys } from \"@vuepress/helper/client\";\n\nimport type { Code } from \"./typings.js\";\nimport type { CodeDemoOptions } from \"../../../shared/index.js\";\n\ndeclare const CODE_DEMO_OPTIONS: CodeDemoOptions;\n\nexport const options = CODE_DEMO_OPTIONS;\n\nexport type PreProcessorType = \"html\" | \"js\" | \"css\";\n\nexport const preProcessorConfig: Record<\n  PreProcessorType,\n  {\n    types: string[];\n    map: Record<string, string | undefined>;\n  }\n> = {\n  html: {\n    types: [\"html\", \"slim\", \"haml\", \"md\", \"markdown\", \"vue\"],\n    map: {\n      html: \"none\",\n      vue: \"none\",\n      md: \"markdown\",\n    },\n  },\n  js: {\n    types: [\n      \"js\",\n      \"javascript\",\n      \"coffee\",\n      \"coffeescript\",\n      \"ts\",\n      \"typescript\",\n      \"ls\",\n      \"livescript\",\n    ],\n    map: {\n      js: \"none\",\n      javascript: \"none\",\n      coffee: \"coffeescript\",\n      ls: \"livescript\",\n      ts: \"typescript\",\n    },\n  },\n  css: {\n    types: [\"css\", \"less\", \"sass\", \"scss\", \"stylus\", \"styl\"],\n    map: {\n      css: \"none\",\n      styl: \"stylus\",\n    },\n  },\n};\n\nexport const h = (\n  tag: string,\n  attrs?: Record<string, string>,\n  children?: HTMLElement[],\n): HTMLElement => {\n  const node = document.createElement(tag);\n\n  if (isPlainObject(attrs))\n    keys(attrs).forEach((key) => {\n      if (key.indexOf(\"data\")) {\n        // @ts-expect-error: Type is not accurate\n        node[key] = attrs[key];\n      } else {\n        const k = key.replace(\"data\", \"\");\n\n        node.dataset[k] = attrs[key];\n      }\n    });\n\n  if (children)\n    children.forEach((child) => {\n      node.appendChild(child);\n    });\n\n  return node;\n};\n\nexport const getConfig = (\n  config: Partial<CodeDemoOptions>,\n): CodeDemoOptions => ({\n  ...options,\n  ...config,\n  jsLib: Array.from(new Set([options.jsLib ?? [], config.jsLib ?? []].flat())),\n  cssLib: Array.from(\n    new Set([options.cssLib ?? [], config.cssLib ?? []].flat()),\n  ),\n});\n\nexport const loadScript = (\n  state: Record<string, Promise<void>>,\n  link: string,\n): Promise<void> => {\n  if (isDef(state[link])) return state[link];\n\n  const loadEvent = new Promise<void>((resolve) => {\n    const script = document.createElement(\"script\");\n\n    script.src = link;\n    document.querySelector(\"body\")?.appendChild(script);\n\n    script.onload = (): void => {\n      resolve();\n    };\n  });\n\n  state[link] = loadEvent;\n\n  return loadEvent;\n};\n\nexport const injectCSS = (shadowRoot: ShadowRoot, code: Code): void => {\n  if (\n    code.css &&\n    // Style not injected\n    Array.from(shadowRoot.childNodes).every(\n      (element) => element.nodeName !== \"STYLE\",\n    )\n  ) {\n    const style = h(\"style\", { innerHTML: code.css });\n\n    shadowRoot.appendChild(style);\n  }\n};\n\nexport const injectScript = (\n  id: string,\n  shadowRoot: ShadowRoot,\n  code: Code,\n): void => {\n  const scriptText = code.getScript();\n\n  if (\n    scriptText &&\n    // Style not injected\n    Array.from(shadowRoot.childNodes).every(\n      (element) => element.nodeName !== \"SCRIPT\",\n    )\n  ) {\n    const script = document.createElement(\"script\");\n\n    script.appendChild(\n      document.createTextNode(\n        // Here we are fixing `document` variable back to shadowDOM\n        `{const document=window.document.querySelector('#${id} .vp-code-demo-display').shadowRoot;\\n${scriptText}}`,\n      ),\n    );\n    shadowRoot.appendChild(script);\n  }\n};\n","import type Babel from \"@babel/core\";\nimport { keys } from \"@vuepress/helper/client\";\n\nimport type { Code, CodeType } from \"./typings.js\";\nimport { getConfig, preProcessorConfig } from \"./utils.js\";\nimport type { CodeDemoOptions } from \"../../../shared/index.js\";\n\ndeclare global {\n  interface Window {\n    Babel: typeof Babel;\n  }\n}\n\nconst AVAILABLE_LANGUAGES = [\"html\", \"js\", \"css\"] as const;\n\nexport const getCode = (code: Record<string, string>): CodeType => {\n  const languages = keys(code);\n  const result: CodeType = {\n    html: [],\n    js: [],\n    css: [],\n    isLegal: false,\n  };\n\n  AVAILABLE_LANGUAGES.forEach((type) => {\n    const match = languages.filter((language) =>\n      preProcessorConfig[type].types.includes(language),\n    );\n\n    if (match.length) {\n      const language = match[0];\n\n      result[type] = [\n        code[language].replace(/^\\n|\\n$/g, \"\"),\n        preProcessorConfig[type].map[language] ?? language,\n      ];\n    }\n  });\n\n  result.isLegal =\n    (!result.html.length || result.html[1] === \"none\") &&\n    (!result.js.length || result.js[1] === \"none\") &&\n    (!result.css.length || result.css[1] === \"none\");\n\n  return result;\n};\n\nconst handleHTML = (html: string): string =>\n  html\n    .replace(/<br \\/>/g, \"<br>\")\n    .replace(/<((\\S+)[^<]*?)\\s+\\/>/g, \"<$1></$2>\");\n\nconst getHtmlTemplate = (html: string): string =>\n  `<div id=\"app\">\\n${handleHTML(html)}\\n</div>`;\n\nconst getReactTemplate = (code: string): string =>\n  `${code\n    .replace(\"export default \", \"const $reactApp = \")\n    .replace(\n      /App\\.__style__(\\s*)=(\\s*)`([\\s\\S]*)?`/,\n      \"\",\n    )};\\nReactDOM.createRoot(document.getElementById(\"app\")).render(React.createElement($reactApp))`;\n\nconst getVueJsTemplate = (js: string): string =>\n  js\n    .replace(\n      /export\\s+default\\s*\\{(\\n*[\\s\\S]*)\\n*\\}\\s*;?$/u,\n      \"Vue.createApp({$1}).mount('#app')\",\n    )\n    .replace(\n      /export\\s+default\\s*define(Async)?Component\\s*\\(\\s*\\{(\\n*[\\s\\S]*)\\n*\\}\\s*\\)\\s*;?$/u,\n      \"Vue.createApp({$1}).mount('#app')\",\n    )\n    .trim();\n\nexport const wrapper = (scriptStr: string): string =>\n  `(function(exports){var module={};module.exports=exports;${scriptStr};return module.exports.__esModule?exports.default:module.exports;})({})`;\n\nexport const getNormalCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>,\n): Code => {\n  const codeConfig = getConfig(config);\n  const js = code.js[0] ?? \"\";\n\n  return {\n    ...codeConfig,\n    html: handleHTML(code.html[0] ?? \"\"),\n    js,\n    css: code.css[0] ?? \"\",\n    isLegal: code.isLegal,\n    getScript: (): string =>\n      codeConfig.useBabel\n        ? (window.Babel.transform(js, { presets: [\"es2015\"] })?.code ?? \"\")\n        : js,\n  };\n};\n\nconst VUE_TEMPLATE_REG = /<template>([\\s\\S]+)<\\/template>/u;\nconst VUE_SCRIPT_REG = /<script(\\s*lang=(['\"])(.*?)\\2)?>([\\s\\S]+)<\\/script>/u;\nconst VUE_STYLE_REG =\n  /<style(\\s*lang=(['\"])(.*?)\\2)?\\s*(?:scoped)?>([\\s\\S]+)<\\/style>/u;\n\nexport const getVueCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>,\n): Code => {\n  const codeConfig = getConfig(config);\n\n  const vueTemplate = code.html[0] ?? \"\";\n  const htmlBlock = VUE_TEMPLATE_REG.exec(vueTemplate);\n  const jsBlock = VUE_SCRIPT_REG.exec(vueTemplate);\n  const cssBlock = VUE_STYLE_REG.exec(vueTemplate);\n  const html = htmlBlock?.[1].replace(/^\\n|\\n$/g, \"\") ?? \"\";\n  const [js = \"\", jsLang = \"\"] = jsBlock\n    ? [jsBlock[4].replace(/^\\n|\\n$/g, \"\"), jsBlock[3]]\n    : [];\n  const [css = \"\", cssLang = \"\"] = cssBlock\n    ? [cssBlock[4].replace(/^\\n|\\n$/g, \"\"), cssBlock[3]]\n    : [];\n\n  const isLegal = jsLang === \"\" && (cssLang === \"\" || cssLang === \"css\");\n\n  return {\n    ...codeConfig,\n    html: getHtmlTemplate(html),\n    js: getVueJsTemplate(js),\n    css,\n    isLegal,\n    jsLib: [codeConfig.vue, ...codeConfig.jsLib],\n    getScript: (): string => {\n      const scriptStr = config.useBabel\n        ? (window.Babel?.transform(js, { presets: [\"es2015\"] })?.code ?? \"\")\n        : js.replace(/export\\s+default/u, \"return\");\n\n      return `const app=window.document.createElement('div');document.firstElementChild.appendChild(app);const appOptions=${wrapper(\n        scriptStr,\n      )};appOptions.template=\\`${html.replace(\n        \"`\",\n        '\\\\`\"',\n      )}\\`;window.Vue.createApp(appOptions).mount(app);`;\n    },\n  };\n};\n\nexport const getReactCode = (\n  code: CodeType,\n  config: Partial<CodeDemoOptions>,\n): Code => {\n  const codeConfig = getConfig(config);\n  const js = code.js[0] ?? \"\";\n\n  return {\n    ...codeConfig,\n    html: getHtmlTemplate(\"\"),\n    js: getReactTemplate(js),\n    css:\n      code.css[0] ??\n      code.js[0]\n        ?.replace(/App\\.__style__(?:\\s*)=(?:\\s*)`([\\s\\S]*)?`/, \"$1\")\n        .trim() ??\n      \"\",\n    isLegal: code.isLegal,\n    jsLib: [codeConfig.react, codeConfig.reactDOM, ...codeConfig.jsLib],\n    jsx: true,\n    getScript: (): string => {\n      const scriptStr =\n        window.Babel?.transform(js, {\n          presets: [\"es2015\", \"react\"],\n        })?.code ?? \"\";\n\n      return `window.ReactDOM.createRoot(document.firstElementChild).render(window.React.createElement(${wrapper(\n        scriptStr,\n      )}))`;\n    },\n  };\n};\n","import type { Code } from \"../utils/index.js\";\nimport { loadScript } from \"../utils/index.js\";\n\nexport type ScriptLoadState = Record<string, Promise<void>>;\n\nconst state: ScriptLoadState = {};\n\nexport const loadReact = (code: Code): Promise<void[]> =>\n  Promise.all([\n    loadScript(state, code.babel),\n    loadScript(state, code.react),\n    loadScript(state, code.reactDOM),\n  ]);\n\nexport const loadVue = (code: Code): Promise<void[]> => {\n  const promises = [loadScript(state, code.vue)];\n\n  if (code.useBabel) promises.push(loadScript(state, code.babel));\n\n  return Promise.all(promises);\n};\n\nexport const loadNormal = (code: Code): Promise<void> =>\n  code.useBabel ? loadScript(state, code.babel) : Promise.resolve();\n","import { LoadingIcon, decodeData, wait } from \"@vuepress/helper/client\";\nimport { useEventListener, useToggle } from \"@vueuse/core\";\nimport type { PropType, SlotsType, VNode } from \"vue\";\nimport { computed, defineComponent, h, onMounted, ref, shallowRef } from \"vue\";\n\nimport { CODEPEN_SVG, JSFIDDLE_SVG } from \"./icons.js\";\nimport type { CodeDemoOptions } from \"../../shared/index.js\";\nimport { loadNormal, loadReact, loadVue } from \"../composables/loadScript.js\";\nimport {\n  getCode,\n  getNormalCode,\n  getReactCode,\n  getVueCode,\n  injectCSS,\n  injectScript,\n} from \"../utils/index.js\";\n\nimport \"balloon-css/balloon.css\";\nimport \"../styles/code-demo.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nexport default defineComponent({\n  name: \"CodeDemo\",\n\n  props: {\n    /**\n     * Code demo id\n     *\n     * 代码演示 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Code demo type\n     *\n     * 代码演示类型\n     */\n    type: {\n      type: String as PropType<\"normal\" | \"vue\" | \"react\">,\n      default: \"normal\",\n    },\n\n    /**\n     * Code demo title\n     *\n     * 代码演示标题\n     */\n    title: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Code demo config\n     *\n     * 代码演示配置\n     */\n    config: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Code demo code content\n     *\n     * 代码演示代码内容\n     */\n    code: {\n      type: String,\n      required: true,\n    },\n  },\n\n  slots: Object as SlotsType<{\n    default: () => VNode[];\n  }>,\n\n  setup(props, { slots }) {\n    const [isExpanded, toggleIsExpand] = useToggle(false);\n    const demoWrapper = shallowRef<HTMLDivElement>();\n    const codeContainer = shallowRef<HTMLDivElement>();\n    const height = ref(\"0\");\n    const loaded = ref(false);\n\n    const config = computed(\n      () =>\n        JSON.parse(\n          props.config ? decodeData(props.config) : \"{}\",\n        ) as Partial<CodeDemoOptions>,\n    );\n\n    const codeType = computed(() => {\n      const codeConfig = JSON.parse(decodeData(props.code)) as Record<\n        string,\n        string\n      >;\n\n      return getCode(codeConfig);\n    });\n\n    const code = computed(() =>\n      props.type === \"react\"\n        ? getReactCode(codeType.value, config.value)\n        : props.type === \"vue\"\n          ? getVueCode(codeType.value, config.value)\n          : getNormalCode(codeType.value, config.value),\n    );\n\n    const isLegal = computed(() => code.value.isLegal);\n\n    const initDom = (innerHTML = false): void => {\n      // Attach a shadow root to demo\n\n      const shadowRoot = demoWrapper.value!.attachShadow({ mode: \"open\" });\n      const appElement = document.createElement(\"div\");\n\n      appElement.classList.add(\"code-demo-app\");\n      shadowRoot.appendChild(appElement);\n\n      if (isLegal.value) {\n        if (innerHTML) appElement.innerHTML = code.value.html;\n        injectCSS(shadowRoot, code.value);\n        injectScript(props.id, shadowRoot, code.value);\n\n        height.value = \"0\";\n      } else {\n        height.value = \"auto\";\n      }\n\n      loaded.value = true;\n    };\n\n    const loadDemo = (): Promise<void> => {\n      switch (props.type) {\n        case \"react\": {\n          return loadReact(code.value).then(() => initDom());\n        }\n        case \"vue\": {\n          return loadVue(code.value).then(() => initDom());\n        }\n\n        default: {\n          return loadNormal(code.value).then(() => initDom(true));\n        }\n      }\n    };\n\n    useEventListener(\"beforeprint\", () => {\n      toggleIsExpand(true);\n    });\n\n    onMounted(async () => {\n      await wait(MARKDOWN_ENHANCE_DELAY);\n      await loadDemo();\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"vp-container vp-code-demo\", id: props.id }, [\n        h(\"div\", { class: \"vp-container-header\" }, [\n          code.value.isLegal\n            ? h(\"button\", {\n                type: \"button\",\n                title: \"toggle\",\n                \"aria-hidden\": true,\n                class: [\n                  \"vp-code-demo-toggle-button\",\n                  isExpanded.value ? \"down\" : \"end\",\n                ],\n                onClick: () => {\n                  height.value = isExpanded.value\n                    ? \"0\"\n                    : `${codeContainer.value!.clientHeight + 13.8}px`;\n                  toggleIsExpand();\n                },\n              })\n            : null,\n          props.title\n            ? h(\n                \"span\",\n                { class: \"vp-container-title\" },\n                decodeURIComponent(props.title),\n              )\n            : null,\n\n          code.value.isLegal && code.value.jsfiddle !== false\n            ? h(\n                \"form\",\n                {\n                  class: \"code-demo-jsfiddle\",\n                  target: \"_blank\",\n                  action: \"https://jsfiddle.net/api/post/library/pure/\",\n                  method: \"post\",\n                },\n                [\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"html\",\n                    value: code.value.html,\n                  }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"js\",\n                    value: code.value.js,\n                  }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"css\",\n                    value: code.value.css,\n                  }),\n                  h(\"input\", { type: \"hidden\", name: \"wrap\", value: \"1\" }),\n                  h(\"input\", { type: \"hidden\", name: \"panel_js\", value: \"3\" }),\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"resources\",\n                    value: [...code.value.cssLib, ...code.value.jsLib].join(\n                      \",\",\n                    ),\n                  }),\n                  h(\"button\", {\n                    type: \"submit\",\n                    class: \"jsfiddle-button\",\n                    innerHTML: JSFIDDLE_SVG,\n                    \"aria-label\": \"JSFiddle\",\n                    \"data-balloon-pos\": \"down\",\n                  }),\n                ],\n              )\n            : null,\n\n          !code.value.isLegal || code.value.codepen !== false\n            ? h(\n                \"form\",\n                {\n                  class: \"code-demo-codepen\",\n                  target: \"_blank\",\n                  action: \"https://codepen.io/pen/define\",\n                  method: \"post\",\n                },\n                [\n                  h(\"input\", {\n                    type: \"hidden\",\n                    name: \"data\",\n                    value: JSON.stringify({\n                      html: code.value.html,\n                      js: code.value.js,\n                      css: code.value.css,\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      js_external: code.value.jsLib.join(\";\"),\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      css_external: code.value.cssLib.join(\";\"),\n                      layout: code.value.codepenLayout,\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      html_pre_processor: codeType.value\n                        ? codeType.value.html[1]\n                        : \"none\",\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      js_pre_processor: codeType.value\n                        ? codeType.value.js[1]\n                        : code.value.jsx\n                          ? \"babel\"\n                          : \"none\",\n                      // eslint-disable-next-line @typescript-eslint/naming-convention\n                      css_pre_processor: codeType.value\n                        ? codeType.value.css[1]\n                        : \"none\",\n                      editors: code.value.codepenEditors,\n                    }),\n                  }),\n                  h(\"button\", {\n                    type: \"submit\",\n                    innerHTML: CODEPEN_SVG,\n                    class: \"codepen-button\",\n                    \"aria-label\": \"Codepen\",\n                    \"data-balloon-pos\": \"down\",\n                  }),\n                ],\n              )\n            : null,\n        ]),\n        loaded.value ? null : h(LoadingIcon, { class: \"vp-code-demo-loading\" }),\n        h(\"div\", {\n          ref: demoWrapper,\n          class: \"vp-code-demo-display\",\n          style: {\n            display: isLegal.value && loaded.value ? \"block\" : \"none\",\n          },\n        }),\n\n        h(\n          \"div\",\n          {\n            class: \"vp-code-demo-code-wrapper\",\n            style: { height: height.value },\n          },\n          h(\n            \"div\",\n            {\n              ref: codeContainer,\n              class: \"vp-code-demo-codes\",\n            },\n            slots.default?.(),\n          ),\n        ),\n      ]);\n  },\n});\n"],"names":["options","preProcessorConfig","h","tag","attrs","children","node","isPlainObject","keys","key","k","getConfig","config","loadScript","state","link","isDef","loadEvent","resolve","script","injectCSS","shadowRoot","code","element","style","injectScript","id","scriptText","AVAILABLE_LANGUAGES","getCode","languages","result","type","match","language","handleHTML","html","getHtmlTemplate","getReactTemplate","getVueJsTemplate","js","wrapper","scriptStr","getNormalCode","codeConfig","VUE_TEMPLATE_REG","VUE_SCRIPT_REG","VUE_STYLE_REG","getVueCode","vueTemplate","htmlBlock","jsBlock","cssBlock","jsLang","css","cssLang","isLegal","getReactCode","loadReact","loadVue","promises","loadNormal","CodeDemo","defineComponent","props","slots","isExpanded","toggleIsExpand","useToggle","demoWrapper","shallowRef","codeContainer","height","ref","loaded","computed","decodeData","codeType","initDom","innerHTML","appElement","loadDemo","useEventListener","onMounted","wait","JSFIDDLE_SVG","CODEPEN_SVG","LoadingIcon"],"mappings":"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"}