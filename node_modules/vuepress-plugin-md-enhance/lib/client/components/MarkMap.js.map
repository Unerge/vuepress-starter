{"version":3,"file":"MarkMap.js","sources":["../../../src/client/components/MarkMap.ts"],"sourcesContent":["import { LoadingIcon, decodeData, wait } from \"@vuepress/helper/client\";\nimport { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Markmap } from \"markmap-view\";\nimport type { VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n} from \"vue\";\n\nimport \"../styles/markmap.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nexport default defineComponent({\n  name: \"MarkMap\",\n\n  props: {\n    /**\n     * Chart id\n     *\n     * 图表 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Markmap content\n     *\n     * Markmap\n     */\n    content: { type: String, required: true },\n  },\n\n  setup(props) {\n    const loading = ref(true);\n    const markupWrapper = shallowRef<HTMLElement>();\n    const markmapSvg = shallowRef<SVGElement>();\n\n    let markupMap: Markmap | null = null;\n\n    useEventListener(\n      \"resize\",\n      useDebounceFn(() => {\n        void markupMap?.fit();\n      }, 100),\n    );\n\n    onMounted(() => {\n      void Promise.all([\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-lib\"),\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-toolbar\"),\n        import(/* webpackChunkName: \"markmap\" */ \"markmap-view\"),\n        wait(MARKDOWN_ENHANCE_DELAY),\n      ]).then(\n        async ([{ Transformer }, { Toolbar }, { Markmap, deriveOptions }]) => {\n          const transformer = new Transformer();\n          const { frontmatter, root } = transformer.transform(\n            decodeData(props.content),\n          );\n\n          markupMap = Markmap.create(\n            markmapSvg.value!,\n            deriveOptions({\n              maxWidth: 240,\n              ...frontmatter?.markmap,\n            }),\n          );\n\n          const { el } = Toolbar.create(markupMap);\n\n          markupMap.setData(root);\n          await markupMap.fit();\n\n          el.style.position = \"absolute\";\n          el.style.bottom = \"0.5rem\";\n          el.style.right = \"0.5rem\";\n\n          markupWrapper.value!.append(el);\n          loading.value = false;\n        },\n      );\n    });\n\n    onUnmounted(() => {\n      markupMap?.destroy();\n    });\n\n    return (): VNode =>\n      h(\"div\", { class: \"markmap-wrapper\", ref: markupWrapper }, [\n        h(\"svg\", {\n          ref: markmapSvg,\n          class: \"markmap-svg\",\n          id: props.id,\n        }),\n        loading.value\n          ? h(LoadingIcon, { class: \"markmap-loading\", height: 360 })\n          : null,\n      ]);\n  },\n});\n"],"names":["MarkMap","defineComponent","props","loading","ref","markupWrapper","shallowRef","markmapSvg","markupMap","useEventListener","useDebounceFn","onMounted","wait","Transformer","Toolbar","Markmap","deriveOptions","transformer","frontmatter","root","decodeData","el","onUnmounted","h","LoadingIcon"],"mappings":"wRAiBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,QAAS,CAAE,KAAM,OAAQ,SAAU,EAAK,CAC1C,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAUC,EAAI,EAAI,EAClBC,EAAgBC,EAAAA,EAChBC,EAAaD,EAAuB,EAE1C,IAAIE,EAA4B,KAEhC,OAAAC,EACE,SACAC,EAAc,IAAM,CACbF,GAAW,IAClB,CAAA,EAAG,GAAG,CACR,EAEAG,EAAU,IAAM,CACT,QAAQ,IAAI,CACf,OAAyC,aAAa,EACtD,OAAyC,iBAAiB,EAC1D,OAAyC,cAAc,EACvDC,EAAK,sBAAsB,CAC7B,CAAC,EAAE,KACD,MAAO,CAAC,CAAE,YAAAC,CAAY,EAAG,CAAE,QAAAC,CAAQ,EAAG,CAAE,QAAAC,EAAS,cAAAC,CAAc,CAAC,IAAM,CACpE,MAAMC,EAAc,IAAIJ,EAClB,CAAE,YAAAK,EAAa,KAAAC,CAAK,EAAIF,EAAY,UACxCG,EAAWlB,EAAM,OAAO,CAC1B,EAEAM,EAAYO,EAAQ,OAClBR,EAAW,MACXS,EAAc,CACZ,SAAU,IACV,GAAGE,GAAa,OAClB,CAAC,CACH,EAEA,KAAM,CAAE,GAAAG,CAAG,EAAIP,EAAQ,OAAON,CAAS,EAEvCA,EAAU,QAAQW,CAAI,EACtB,MAAMX,EAAU,IAAI,EAEpBa,EAAG,MAAM,SAAW,WACpBA,EAAG,MAAM,OAAS,SAClBA,EAAG,MAAM,MAAQ,SAEjBhB,EAAc,MAAO,OAAOgB,CAAE,EAC9BlB,EAAQ,MAAQ,EAClB,CACF,CACF,CAAC,EAEDmB,EAAY,IAAM,CAChBd,GAAW,QACb,CAAA,CAAC,EAEM,IACLe,EAAE,MAAO,CAAE,MAAO,kBAAmB,IAAKlB,CAAc,EAAG,CACzDkB,EAAE,MAAO,CACP,IAAKhB,EACL,MAAO,cACP,GAAIL,EAAM,EACZ,CAAC,EACDC,EAAQ,MACJoB,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EACxD,IACN,CAAC,CACL,CACF,CAAC"}