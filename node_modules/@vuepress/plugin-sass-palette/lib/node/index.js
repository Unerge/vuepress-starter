import{Logger as A,getBundlerName as L,mergeViteConfig as M,isString as j,isFunction as x,addViteConfig as N,chainWebpack as B}from"@vuepress/helper";import{watch as y}from"chokidar";import{getDirname as I,path as b,fs as V}from"vuepress/utils";const W=I(import.meta.url),C=b.resolve(W,"../../styles/empty.scss"),E="@vuepress/plugin-sass-palette",f=new A(E),d=t=>V.pathExistsSync(t)?t:C,a=t=>t?`${t}-`:"",_=(t,e,s)=>{const l=L(e);if(l==="vite"){const i=t,o=i.viteOptions?.css?.preprocessorOptions?.scss.additionalData;i.viteOptions=M(i.viteOptions??{},{css:{preprocessorOptions:{scss:{charset:!1,additionalData:async(r,c)=>{let n=j(o)?`${o}${r}`:x(o)?await o(r,c):r;return n.match(new RegExp(`@use\\s+(["'])@sass-palette\\/${a(s)}config\\1;`))||(n=`@use "@sass-palette/${a(s)}config";
${n}`),n.match(new RegExp(`@use\\s+(["'])@sass-palette\\/${a(s)}palette\\1;`))||(n=`@use "@sass-palette/${a(s)}palette";
${n}`),n}}}}})}else if(l==="webpack"){const i=t;i.scss||(i.scss={});const{additionalData:o}=i.scss,r=(c,n)=>{let p=j(o)?`${o}${c}`:x(o)?o(c,n):c;return p.match(new RegExp(`@use\\s+(["'])@sass-palette\\/${a(s)}config\\1;`))||(p=`@use "@sass-palette/${a(s)}config";
${p}`),p.match(new RegExp(`@use\\s+(["'])@sass-palette\\/${a(s)}palette\\1;`))||(p=`@use "@sass-palette/${a(s)}palette";
${p}`),p};i.scss.additionalData=r}},z=(t,e)=>t.writeTemp(`sass-palette/load-${e||"default"}.js`,`import "@sass-palette/${a(e)}inject";
`),w=(t,e,s,l)=>t.writeTemp(`sass-palette/${a(e)}config.scss`,`@import "file:///${d(s)}";
@import "file:///${d(l)}";
`),G=(t,e)=>t.writeTemp(`sass-palette/${a(e)}inject.scss`,`@use "sass:meta";
@use "@sass-palette/helper";
@use "@sass-palette/${a(e)}palette";

$palette-variables: meta.module-variables("${a(e)}palette");
${t.env.isDebug?`
@debug "${e} config variables: #{meta.inspect(meta.module-variables("${a(e)}config"))}";
@debug "${e} palette variables: #{meta.inspect($palette-variables)}";
`:""}

@include helper.inject($palette-variables);
`),k=(t,{id:e,defaultPalette:s,generator:l,userPalette:i})=>t.writeTemp(`sass-palette/${a(e)}palette.scss`,`${s?`@import "file:///${d(s)}";`:""}
@import "file:///${d(i)}";
@import "file:///${d(l)}";
`),T=(t,e,s)=>s?t.writeTemp(`sass-palette/${a(e)}style.scss`,`@forward "file:///${d(s)}";
`):Promise.resolve(null),F=I(import.meta.url),R=t=>e=>{e.env.isDebug&&f.info("Options:",t);const{id:s="",config:l=`.vuepress/styles/${a(s)}config.scss`,defaultConfig:i=b.resolve(F,"../../styles/default/config.scss"),palette:o=`.vuepress/styles/${a(s)}palette.scss`,defaultPalette:r,generator:c=C,style:n=""}=t,p=e.dir.source(l),v=e.dir.source(o),m=n?e.dir.source(n):null;return{name:E,multiple:!0,id:s,alias:{"@sass-palette/helper":b.resolve(F,"../../styles/helper.scss"),[`@sass-palette/${a(s)}config`]:e.dir.temp(`sass-palette/${a(s)}config.scss`),[`@sass-palette/${a(s)}inject`]:e.dir.temp(`sass-palette/${a(s)}inject.scss`),[`@sass-palette/${a(s)}palette`]:e.dir.temp(`sass-palette/${a(s)}palette.scss`),...n?{[`@sass-palette/${a(s)}style`]:e.dir.temp(`sass-palette/${a(s)}style.scss`)}:{}},extendsBundlerOptions:$=>{N($,e,{css:{preprocessorOptions:{sass:{api:"modern",silenceDeprecations:["import"]},scss:{api:"modern",silenceDeprecations:["import"]}}}}),B($,e,g=>{g.module.rule("scss").use("sass-loader").tap(u=>({...u,sassOptions:{...u.sassOptions,silenceDeprecations:["import",...u.sassOptions?.silenceDeprecations??[]]}}))}),_($,e,s)},onInitialized:()=>Promise.all([w(e,s,i,p),G(e,s),k(e,{id:s,defaultPalette:r,generator:c,userPalette:v}),T(e,s,m)]).then(()=>{e.env.isDebug&&f.info(`Style file for ${s} generated`)}),onWatched:($,g)=>{const u=y(p,{cwd:e.dir.source(),ignoreInitial:!0}),D=()=>w(e,s,i,p).then(()=>{e.env.isDebug&&f.info(`Style file for ${s} updated`)});u.on("add",()=>{D()}),u.on("unlink",()=>{D()}),g.push(u);const h=y(v,{cwd:e.dir.source(),ignoreInitial:!0}),S=()=>Promise.all([w(e,s,i,p),k(e,{id:s,defaultPalette:r,generator:c,userPalette:v})]).then(()=>{e.env.isDebug&&f.info(`Style file for ${s} updated`)});if(h.on("add",()=>{S()}),h.on("unlink",()=>{S()}),g.push(h),m){const P=y(m,{cwd:e.dir.source(),ignoreInitial:!0}),O=()=>T(e,s,m).then(()=>{e.env.isDebug&&f.info(`Style file for ${s} updated`)});P.on("add",()=>{O()}),P.on("unlink",()=>{O()}),g.push(P)}},clientConfigFile:()=>z(e,s)}},U=(t,e)=>{const{plugins:s}=t.pluginApi,l=s.filter(i=>i.name==="@vuepress/plugin-sass-palette").findIndex(i=>i.id===e);l!==-1&&s.splice(l,1)},Y=(t,e)=>{const{plugins:s}=t.pluginApi;s.filter(l=>l.name==="@vuepress/plugin-sass-palette").every(l=>l.id!==e.id)&&t.use(R(e))};export{U as removePalettePlugin,R as sassPalettePlugin,Y as useSassPalettePlugin};
//# sourceMappingURL=index.js.map
