{"version":3,"file":"ArtalkComment.js","sources":["../../../src/client/components/ArtalkComment.ts"],"sourcesContent":["import { LoadingIcon, isString, wait } from '@vuepress/helper/client'\nimport type Artalk from 'artalk'\nimport type { VNode } from 'vue'\nimport {\n  computed,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { usePageData, useSiteData } from 'vuepress/client'\nimport { useArtalkOptions } from '../helpers/index.js'\n\nimport 'artalk/dist/Artalk.css'\n\nexport default defineComponent({\n  name: 'ArtalkComment',\n\n  props: {\n    /**\n     * The path of the comment\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const artalkOptions = useArtalkOptions()\n    const page = usePageData()\n    const site = useSiteData()\n\n    const loaded = ref(false)\n    const artalkContainer = shallowRef<HTMLDivElement>()\n\n    let artalk: Artalk | null = null\n\n    const enableArtalk = computed(() => isString(artalkOptions.value.server))\n\n    const initArtalk = async (): Promise<void> => {\n      const [{ default: Artalk }] = await Promise.all([\n        import(/* webpackChunkName: \"artalk\" */ 'artalk/dist/Artalk.mjs'),\n        wait(artalkOptions.value.delay ?? 800),\n      ])\n\n      loaded.value = true\n      await nextTick()\n\n      artalk = Artalk.init({\n        useBackendConf: false,\n        site: site.value.title,\n        pageTitle: page.value.title,\n        ...artalkOptions.value,\n        el: artalkContainer.value!,\n        pageKey: props.identifier,\n        darkMode: props.darkmode,\n      })\n\n      if (artalkOptions.value.useBackendConf)\n        artalk.on('mounted', () => {\n          artalk!.setDarkMode(props.darkmode)\n        })\n    }\n\n    const updateArtalk = (): void => {\n      artalk!.update({\n        site: site.value.title,\n        pageTitle: page.value.title,\n        pageKey: props.identifier,\n      })\n      artalk!.reload()\n    }\n\n    onMounted(() => {\n      watch(\n        () => artalkOptions.value,\n        () => {\n          artalk?.destroy()\n          void initArtalk()\n        },\n        { immediate: true },\n      )\n\n      watch(\n        () => props.identifier,\n        () => {\n          if (artalk)\n            void nextTick().then(() => {\n              updateArtalk()\n            })\n        },\n      )\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value)\n        },\n      )\n    })\n\n    onUnmounted(() => {\n      artalk?.destroy()\n    })\n\n    return (): VNode | null =>\n      enableArtalk.value\n        ? h('div', { class: 'artalk-wrapper' }, [\n            loaded.value ? null : h(LoadingIcon),\n            h('div', { ref: artalkContainer }),\n          ])\n        : null\n  },\n})\n"],"names":["ArtalkComment","defineComponent","props","artalkOptions","useArtalkOptions","page","usePageData","site","useSiteData","loaded","ref","artalkContainer","shallowRef","artalk","enableArtalk","computed","isString","initArtalk","Artalk","wait","nextTick","updateArtalk","onMounted","watch","value","onUnmounted","h","LoadingIcon"],"mappings":"kWAmBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAIL,WAAY,CACV,KAAM,OACN,SAAU,EACZ,EAOA,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,EAChBC,EAAAA,EAAOC,IACPC,EAAOC,EAAY,EAEnBC,EAASC,EAAI,EAAK,EAClBC,EAAkBC,IAExB,IAAIC,EAAwB,KAE5B,MAAMC,EAAeC,EAAS,IAAMC,EAASb,EAAc,MAAM,MAAM,CAAC,EAElEc,EAAa,SAA2B,CAC5C,KAAM,CAAC,CAAE,QAASC,CAAO,CAAC,EAAI,MAAM,QAAQ,IAAI,CAC9C,OAAwC,wBAAwB,EAChEC,EAAKhB,EAAc,MAAM,OAAS,GAAG,CACvC,CAAC,EAEDM,EAAO,MAAQ,GACf,MAAMW,EAAAA,EAENP,EAASK,EAAO,KAAK,CACnB,eAAgB,GAChB,KAAMX,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,GAAGF,EAAc,MACjB,GAAIQ,EAAgB,MACpB,QAAST,EAAM,WACf,SAAUA,EAAM,QAClB,CAAC,EAEGC,EAAc,MAAM,gBACtBU,EAAO,GAAG,UAAW,IAAM,CACzBA,EAAQ,YAAYX,EAAM,QAAQ,CACpC,CAAC,CACL,EAEMmB,EAAe,IAAY,CAC/BR,EAAQ,OAAO,CACb,KAAMN,EAAK,MAAM,MACjB,UAAWF,EAAK,MAAM,MACtB,QAASH,EAAM,UACjB,CAAC,EACDW,EAAQ,OAAO,CACjB,EAEA,OAAAS,EAAU,IAAM,CACdC,EACE,IAAMpB,EAAc,MACpB,IAAM,CACJU,GAAQ,QAAQ,EACXI,EACP,CAAA,EACA,CAAE,UAAW,EAAK,CACpB,EAEAM,EACE,IAAMrB,EAAM,WACZ,IAAM,CACAW,GACGO,IAAW,KAAK,IAAM,CACzBC,EACF,CAAA,CAAC,CACL,CACF,EAEAE,EACE,IAAMrB,EAAM,SACXsB,GAAU,CACTX,GAAQ,YAAYW,CAAK,CAC3B,CACF,CACF,CAAC,EAEDC,EAAY,IAAM,CAChBZ,GAAQ,QAAQ,CAClB,CAAC,EAEM,IACLC,EAAa,MACTY,EAAE,MAAO,CAAE,MAAO,gBAAiB,EAAG,CACpCjB,EAAO,MAAQ,KAAOiB,EAAEC,CAAW,EACnCD,EAAE,MAAO,CAAE,IAAKf,CAAgB,CAAC,CACnC,CAAC,EACD,IACR,CACF,CAAC"}