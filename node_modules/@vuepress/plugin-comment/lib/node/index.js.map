{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/getProvider.ts","../../src/node/locales.ts","../../src/node/commentPlugin.ts"],"sourcesContent":["import { Logger, ensureEndingSlash } from '@vuepress/helper'\nimport { getDirname, path } from 'vuepress/utils'\n\nconst __dirname = getDirname(import.meta.url)\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, '../client'),\n)\n\nexport const PLUGIN_NAME = '@vuepress/plugin-comment'\n\nexport const logger = new Logger(PLUGIN_NAME)\n","import { getRealPath } from '@vuepress/helper'\nimport type { CommentPluginOptions } from './options.js'\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from './utils.js'\n\nconst COMMENT_SERVICES = ['Artalk', 'Giscus', 'Waline', 'Twikoo']\nconst PAGEVIEW_SERVICES = ['Artalk', 'Waline']\n\nexport const getServiceComponent = (provider = 'None'): string => {\n  if (COMMENT_SERVICES.includes(provider))\n    return `${CLIENT_FOLDER}components/${provider}Comment.js`\n\n  if (provider !== 'None') logger.error(`Invalid provider: ${provider}`)\n\n  return getRealPath('@vuepress/helper/noopModule', import.meta.url)\n}\n\nexport const getPageviewChunk = (provider = 'None'): string =>\n  `${CLIENT_FOLDER}pageview/${PAGEVIEW_SERVICES.includes(provider) ? provider.toLowerCase() : 'noop'}.js`\n\nexport const getAlias = (\n  options: CommentPluginOptions,\n): Record<string, string> => ({\n  [`${PLUGIN_NAME}/service`]: getServiceComponent(options.provider),\n  [`${PLUGIN_NAME}/pageview`]: getPageviewChunk(options.provider),\n})\n\nexport const getProviderPackage = (provider?: string): string | null => {\n  switch (provider) {\n    case 'Artalk':\n      return 'artalk'\n    case 'Twikoo':\n      return 'twikoo'\n    case 'Waline':\n      return '@waline/client'\n\n    default:\n      return null\n  }\n}\n","import type { WalineLocaleConfig } from '../shared/index.js'\n\n/**\n * Default locale config for Waline\n */\nexport const walineLocales: WalineLocaleConfig = {\n  '/en/': {\n    placeholder:\n      'Write a comment here (Fill in the email address to receive an email notification when being replied)',\n  },\n\n  '/zh/': {\n    placeholder: '请留言。(填写邮箱可在被回复时收到邮件提醒)',\n  },\n\n  '/zh-tw/': {\n    placeholder: '請留言。(填寫信箱可在被回覆時收到郵件提醒)',\n  },\n\n  '/de/': {\n    placeholder:\n      'Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)',\n  },\n\n  '/de-at/': {\n    placeholder:\n      'Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)',\n  },\n\n  '/vi/': {\n    placeholder:\n      'Để lại bình luận (Điền địa chỉ email để nhận email thông báo khi được trả lời)',\n  },\n\n  '/uk/': {\n    placeholder:\n      'Напишіть тут коментар (введіть адресу електронної пошти, щоб отримувати сповіщення електронною поштою, коли буде відповідь)',\n  },\n\n  '/ru/': {\n    placeholder:\n      'Напишите комментарий здесь (Введите адрес электронной почты, чтобы получить уведомление по электронной почте при ответе)',\n  },\n\n  '/br/': {\n    placeholder:\n      'Escreva um comentário aqui (preencha com o endereço de email para receber notificações quando tiver alguma resposta)',\n  },\n\n  '/pl/': {\n    placeholder:\n      'Wpisz tutaj komentarz (wpisz adres e-mail, aby otrzymać powiadomienie e-mail, gdy otrzymasz odpowiedź)',\n  },\n\n  '/sk/': {\n    placeholder:\n      'Napíš svoj komentár (vlož svoj e-mail taktiež, aby si bol notifikovaný o odpovediach)',\n  },\n\n  '/fr/': {\n    placeholder:\n      'Écrivez votre commentaire ici (Inscrivez votre email afin de recevoir une notification en cas de réponse)',\n  },\n\n  '/es/': {\n    placeholder:\n      'Escriba un comentario aquí (Ingrese su correo electrónico para recibir una notificación en caso de respuesta)',\n  },\n\n  '/ja/': {\n    placeholder:\n      '伝言をどうぞ (メールアドレスを入力すると、返信があった際にメールでお知らせします。)',\n  },\n\n  '/tr/': {\n    placeholder:\n      'Buraya bir yorum yazın (Yanıtlandığında bir e-posta bildirimi almak için e-posta adresinizi girin)',\n  },\n\n  '/ko/': {\n    placeholder:\n      '댓글을 남겨주세요 (답글이 달렸을 때 이메일로 알림을 받으려면 이메일 주소를 입력하세요)',\n  },\n\n  '/fi/': {\n    placeholder:\n      'Kirjoita kommentti tähän (täytä sähköpostiosoite saadaksesi sähköposti-ilmoituksen vastauksesta)',\n  },\n  '/hu/': {\n    placeholder:\n      'Írj kommentet itt! (Töltsd ki az email címet, hogy értesítést kapj, amikor válaszolnak.)',\n  },\n\n  '/id/': {\n    placeholder:\n      'Tulis komentar di sini (Isi alamat email untuk menerima notifikasi jika komentar kamu telah dibalas orang lain)',\n  },\n\n  '/nl/': {\n    placeholder:\n      'Schrijf een opmerking hier (Vul je emailadres in om een email-notificatie te ontvangen wanneer er gereageerd wordt.',\n  },\n}\n","import {\n  addCustomElement,\n  addViteOptimizeDepsExclude,\n  addViteOptimizeDepsInclude,\n  addViteSsrExternal,\n  addViteSsrNoExternal,\n  getInstalledStatus,\n  getLocaleConfig,\n} from '@vuepress/helper'\nimport type { PluginFunction } from 'vuepress/core'\nimport { getAlias, getProviderPackage } from './getProvider.js'\nimport { walineLocales } from './locales.js'\nimport type { CommentPluginOptions } from './options.js'\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from './utils.js'\n\n/** Comment Plugin */\nexport const commentPlugin =\n  (options: CommentPluginOptions): PluginFunction =>\n  (app) => {\n    if (app.env.isDebug) logger.info('Options:', options)\n\n    const pkg = getProviderPackage(options.provider)\n\n    if (pkg && !getInstalledStatus(pkg, import.meta.url)) {\n      logger.error(\n        `Package ${pkg} is not installed, please install it manually!`,\n      )\n\n      return { name: PLUGIN_NAME }\n    }\n\n    // Remove locales so that they won’t be injected in client twice\n    if (options.provider === 'Waline' && 'locales' in options)\n      delete options.locales\n\n    return {\n      name: PLUGIN_NAME,\n\n      alias: getAlias(options),\n\n      define: () => {\n        const userWalineLocales =\n          options.provider === 'Waline'\n            ? getLocaleConfig({\n                app,\n                name: 'waline',\n                default: walineLocales,\n                config: options.locales,\n              })\n            : {}\n\n        return {\n          __COMMENT_OPTIONS__: options,\n          ...(options.provider === 'Waline'\n            ? {\n                WALINE_LOCALES: userWalineLocales,\n                WALINE_META: options.metaIcon !== false,\n              }\n            : {}),\n        }\n      },\n\n      extendsBundlerOptions: (bundlerOptions: unknown): void => {\n        // eslint-disable-next-line @typescript-eslint/switch-exhaustiveness-check, default-case\n        switch (options.provider) {\n          case 'Artalk': {\n            addViteOptimizeDepsExclude(\n              bundlerOptions,\n              app,\n              'artalk/dist/Artalk.mjs',\n            )\n            addViteSsrExternal(bundlerOptions, app, 'artalk')\n            break\n          }\n\n          case 'Giscus': {\n            addCustomElement(bundlerOptions, app, 'GiscusWidget')\n            addViteSsrExternal(bundlerOptions, app, 'giscus')\n            break\n          }\n\n          case 'Twikoo': {\n            addViteOptimizeDepsInclude(bundlerOptions, app, 'twikoo')\n            addViteSsrExternal(bundlerOptions, app, 'twikoo')\n            break\n          }\n\n          case 'Waline': {\n            addViteOptimizeDepsInclude(bundlerOptions, app, [\n              '@waline/client > autosize',\n              '@waline/client > recaptcha-v3',\n            ])\n            addViteOptimizeDepsExclude(bundlerOptions, app, '@waline/client')\n            addViteSsrExternal(bundlerOptions, app, '@waline/client')\n            break\n          }\n        }\n\n        addViteSsrNoExternal(bundlerOptions, app, [\n          '@vuepress/helper',\n          '@vuepress/plugin-comment',\n        ])\n      },\n\n      clientConfigFile: `${CLIENT_FOLDER}config.js`,\n    }\n  }\n"],"names":["__dirname","getDirname","CLIENT_FOLDER","ensureEndingSlash","path","PLUGIN_NAME","logger","Logger","COMMENT_SERVICES","PAGEVIEW_SERVICES","getServiceComponent","provider","getRealPath","getPageviewChunk","getAlias","options","getProviderPackage","walineLocales","commentPlugin","app","pkg","getInstalledStatus","userWalineLocales","getLocaleConfig","bundlerOptions","addViteOptimizeDepsExclude","addViteSsrExternal","addCustomElement","addViteOptimizeDepsInclude","addViteSsrNoExternal"],"mappings":"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"}